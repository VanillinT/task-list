(this["webpackJsonpbeejee-test-task"]=this["webpackJsonpbeejee-test-task"]||[]).push([[0],{87:function(t,e,n){},94:function(t,e,n){"use strict";n.r(e);var a,r=n(4),c=n(0),i=n.n(c),o=n(10),s=n.n(o),u=(n(87),n(8)),l=n(46),d=n(13),b=n(62),j=n(16),f=Object(j.c)({name:"notifications",initialState:{items:[]},reducers:{notificationAdded:function(t,e){var n=e.payload;t.items.push(n)},notificationRemoved:function(t,e){var n=e.payload;return{items:t.items.filter((function(t){return t.key!==n}))}}}}),p=f.reducer,O=f.actions,h=O.notificationAdded,m=O.notificationRemoved,v=[],g=function(){var t=Object(d.b)(),e=Object(d.c)((function(t){return t.notifications.items})),n=Object(b.b)(),a=n.enqueueSnackbar,r=n.closeSnackbar;return Object(c.useEffect)((function(){e.forEach((function(e){var n,c=e.key,i=e.message,o=e.options,s=void 0===o?{}:o,d=e.dismissed;void 0!==d&&d?r(c):v.includes(c)||(a(i,Object(u.a)(Object(u.a)({key:c},s),{},{onClose:function(t,e,n){s.onClose&&s.onClose(t,e,n)},onExited:function(e,n){var a;t(m(n)),a=n,v=Object(l.a)(v.filter((function(t){return a!==t})))}})),n=c,v=[].concat(Object(l.a)(v),[n]))}))}),[e,r,a,t]),null},x=n(142),k=n(131),y=n(140),w=n(24),C=n(20),N=n.n(C),S=n(35),E=n(30),I=n(72),T=function(){var t=Object(S.a)(N.a.mark((function t(e){var n,a,r,c,i,o;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.method,a=e.path,r=e.params,c=e.data,i="https://uxcandy.com/~shapoval/test-task-backend/v2"+a+"?developer=beb",r&&Object.entries(r).forEach((function(t){var e=Object(E.a)(t,2),n=e[0],a=e[1];return i+="&".concat(n,"=").concat(a)})),t.next=5,Object(I.ajax)({url:i,method:n,crossDomain:!0,mimeType:"multipart/form-data",contentType:!1,processData:!1,data:c,dataType:"json"});case 5:return o=t.sent,t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),D=function(t){var e=t.path,n=t.params;return T({method:"GET",path:e,params:n})},L=function(t){var e=t.path,n=t.data,a=new FormData;return Object.entries(n).forEach((function(t){var e=Object(E.a)(t,2),n=e[0],r=e[1];a.append(n,r)})),T({method:"POST",path:e,data:a})},B=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1};return D({path:"/",params:t})},R=function(t,e){var n=t.token;return Promise.all(e.map((function(t){return function(t,e){var n=t.token;return L({path:"/edit/".concat(e.id),data:Object(u.a)(Object(u.a)({},e),{},{token:n})})}({token:n},t)})))},M=function(t,e,n){var a=!!e.length,r=a?"ok"===e[0].status:"ok"===e.status,c=(a?e[0]:e).message;t(h({message:r?n:"ERROR: ".concat(JSON.stringify(c)),key:(new Date).getTime()+Math.random(),options:{variant:r?"success":"error"}}))},A=function(){var t,e;return(null===(t=document.cookie)||void 0===t||null===(e=t.split(";").find((function(t){return t.trim().startsWith("token")})))||void 0===e?void 0:e.split("=")[1])||""},P=function(t){document.cookie="token=".concat(t,"; path=/")},z=Object(j.c)({name:"modal",initialState:{open:!1},reducers:{modalOpened:function(){return{open:!0}},modalClosed:function(){return{open:!1}}}}),_=z.reducer,W=z.actions,F=W.modalOpened,U=W.modalClosed,J=Object(j.b)("tasks/tasksLoaded",function(){var t=Object(S.a)(N.a.mark((function t(e,n){var a,r,c,i,o,s;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.getState,r=a().tasksListState,c=r.orderBy,i=r.sortDirection,o=r.currentPage,s=B({page:o,sort_field:c,sort_direction:i}),t.abrupt("return",s);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),Z=Object(j.b)("tasks/taskCreated",function(){var t=Object(S.a)(N.a.mark((function t(e,n){var a,r,c;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.dispatch,r=Object(u.a)(Object(u.a)({},e),{},{text:e.text.trim()}),(c=L({path:"/create",data:r})).then((function(t){M(a,t,"New task created successfuly"),"ok"===t.status&&(a(U()),a(J()))})),t.abrupt("return",c);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),q=Object(j.b)("tasks/tasksSaved",function(){var t=Object(S.a)(N.a.mark((function t(e,n){var a,r,c,i,o,s,l,d;return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.dispatch,r=n.getState,c=r(),i=A(),o=c.tasks.unsavedItems,s=o.map((function(t){return Object(u.a)(Object(u.a)({},t),{},{text:t.text.trim()})})),l=o.length,(d=R({token:i},s)).then((function(t){M(a,t,1===l?"Task ".concat(o[0].id," has been updated"):"".concat(l," tasks have been updated"))})),t.abrupt("return",d);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),G=Object(j.c)({name:"tasks",initialState:{items:[],unsavedItems:[],status:"idle",error:null,totalItems:0},reducers:{taskEditedLocally:function(t,e){var n=e.payload;t.items=t.items.map((function(t){return t.id===n.id?n:t})),t.unsavedItems=[].concat(Object(l.a)(t.unsavedItems.filter((function(t){return t.id!==n.id}))),[n])},errorNullified:function(t){return Object(u.a)(Object(u.a)({},t),{},{error:null})}},extraReducers:(a={},Object(w.a)(a,J.fulfilled,(function(t,e){var n=e.payload,a=n.message,r=n.status;if(t.status=r,"error"===r)t.error=a;else{var c=a.tasks,i=a.total_task_count;t.items=Object(l.a)(c),t.totalItems=i}})),Object(w.a)(a,Z.fulfilled,(function(t,e){var n=e.payload,a=n.message,r=n.status;t.status=r,"error"===r?t.error=a:t.length<3&&t.items.push(a)})),Object(w.a)(a,q.fulfilled,(function(t,e){e.payload.every((function(t){return"ok"===t.status}))&&(t.unsavedItems=[])})),a)}),K=G.reducer,$=G.actions,H=$.taskEditedLocally,Q=$.errorNullified,V=function(t){return{tasks:t.tasks.items,count:t.tasks.totalItems}},X=function(t){return t.tasks.unsavedItems},Y=function(t){return 0===t.length?"Enter Email":/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(t)?"":"Incorrect email format."},tt=function(t){return 0===t.length?"Enter Username":t.length<3?"Username is too short":t.length>14?"Username is too long":""},et=function(t){return function(e){return 0===e.length?t:""}},nt=n(129),at=Object(nt.a)({modal:{display:"flex",alignItems:"center",justifyContent:"center"},wrapper:{outline:"none"}}),rt=Object(nt.a)({tableContainer:{height:400},tableBody:{position:"relative"},utilsWrapper:{display:"flex",width:"100%",justifyContent:"space-between",padding:10,margin:"auto"},button:{marginRight:10},pagination:{},textField:{width:"100%",border:"none"}}),ct=n(145),it=n(139),ot=n(7),st=n(130),ut=Object(nt.a)((function(t){return{form:{background:"white",borderRadius:5,minWidth:300,boxShadow:t.shadows[16]},header:{backgroundColor:t.palette.secondary.light,padding:"0 30px",borderRadius:"5px 5px 0 0"},body:{padding:"0 20px 20px",display:"flex",flexDirection:"column"},input:{marginTop:"15px"},backdrop:{backgroundColor:"transparent"}}})),lt=function(t){var e=t.submitButtonLabel,n=void 0===e?"OK":e,a=t.title,i=void 0===a?"":a,o=t.fieldsOptionsMap,s=t.onSubmit,l=t.errors,d=ut(),b=Object(c.useMemo)((function(){return Object.keys(o)})),j=function(){return b.reduce((function(t,e){return Object(u.a)(Object(u.a)({},t),{},Object(w.a)({},e,""))}),{})},f=Object(c.useState)(j()),p=Object(E.a)(f,2),O=p[0],h=p[1],m=Object(c.useState)(j()),v=Object(E.a)(m,2),g=v[0],x=v[1],k=function(t,e,n){return t((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(w.a)({},e,n))}))},y=function(t,e){t.preventDefault(),function(t,e){k(h,t,e)}(e,t.target.value),x(j())};Object(c.useEffect)((function(){x(Object(u.a)(Object(u.a)({},g),l))}),[l]);var C=function(){var t=0;return b.forEach((function(e){var n=o[e].validator,a=O[e];if(n){var r=n(a);r&&t++,function(t,e){k(x,t,e)}(e,r)}})),t};return Object(r.jsxs)(ct.a,{className:d.form,children:[i&&Object(r.jsx)("div",{className:d.header,children:Object(r.jsx)("h2",{children:i})}),Object(r.jsxs)("div",{className:d.body,children:[b.map((function(t){return Object(r.jsx)(it.a,Object(u.a)({className:d.input,variant:"outlined",label:g[t]||Object(ot.a)(t),value:O[t],onChange:function(e){return y(e,t)},error:!!g[t]},function(t){return o[t]&&o[t].props?o[t].props:{}}(t)),t)})),Object(r.jsx)(st.a,{className:d.input,variant:"outlined",onClick:function(){C()>0||s&&s(O)},children:n})]})]})},dt=function(){var t=Object(d.c)((function(t){return t.newTaskModal.open})),e=Object(d.c)((function(t){return t.tasks.error})),n=Object(d.b)(),a=at(),c={username:{validator:tt},email:{validator:Y},text:{validator:et("This field cannot be empty"),props:{multiline:!0,rows:3,rowsMax:5}}};return Object(r.jsx)(x.a,{open:t,onClose:function(){n(U()),n(Q())},className:a.modal,closeAfterTransition:!0,children:Object(r.jsx)(k.a,{in:t,children:Object(r.jsx)(y.a,{className:a.wrapper,children:Object(r.jsx)(lt,{fieldsOptionsMap:c,errors:e,onSubmit:function(t){n(Z(t))},title:"Add new task",submitButtonLabel:"Add"})})})})},bt=n(132),jt=n(133),ft=n(134),pt=n(135),Ot=n(136),ht=n(146),mt=n(137),vt=n(143),gt=n(141),xt={loggedIn:!!A().length,status:"idle",error:null},kt=Object(j.b)("auth/loggedIn",function(){var t=Object(S.a)(N.a.mark((function t(e){return N.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",L({path:"/login",data:e}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),yt=Object(j.c)({name:"user",initialState:xt,reducers:{loggedOut:function(t){P(""),t.loggedIn=!1},errorNullified:function(t){return Object(u.a)(Object(u.a)({},t),{},{error:null})}},extraReducers:Object(w.a)({},kt.fulfilled,(function(t,e){var n=e.payload,a=n.status,r=n.message;if(t.status=a,"error"===a)t.error=r;else{var c=r.token;P(c),c.length>0&&(t.loggedIn=!0)}}))}),wt=yt.reducer,Ct=yt.actions,Nt=Ct.loggedOut,St=Ct.errorNullified,Et=function(t){return t.user.loggedIn},It=Object(j.c)({name:"tasksListState",initialState:{orderBy:null,sortDirection:"desc",currentPage:1},reducers:{orderByChanged:function(t,e){var n=e.payload;return Object(u.a)(Object(u.a)({},t),{},{orderBy:n})},sortDirectionChanged:function(t,e){var n=e.payload;return Object(u.a)(Object(u.a)({},t),{},{sortDirection:n})},currentPageChanged:function(t,e){var n=e.payload;return Object(u.a)(Object(u.a)({},t),{},{currentPage:n})}}}),Tt=It.reducer,Dt=It.actions,Lt=Dt.orderByChanged,Bt=Dt.sortDirectionChanged,Rt=Dt.currentPageChanged,Mt=function(t){return t.tasksListState},At=[{label:"Id",sortable:!0,width:75},{label:"Username",sortable:!0,width:125},{label:"Email",sortable:!0,width:160},{label:"Text",sortable:!1,width:240},{label:"Status",sortable:!0,width:100}],Pt=function(t,e){return{edited:t,done:e}},zt=(Pt(!1,!1),Pt(!0,!1),Pt(!1,!0),Pt(!0,!0),function(t){return 1===String(t).length?"0"+t:String(t)}),_t=function(t,e){var n=e.edited,a=e.done,r=zt(t);return"undefined"!==typeof n&&(r=r[0]+Number(n)),"undefined"!==typeof a&&(r=Number(a)+r[1]),Number(r)},Wt=function(t){var e=zt(t);return{done:"1"===e[0],edited:"1"===e[1]}},Ft=function(){var t=rt(),e=Object(d.b)(),n=Object(d.c)(Mt),a=n.orderBy,i=n.sortDirection,o=n.currentPage,s=Object(d.c)(Et),l=Object(d.c)(X),b=Object(d.c)(V),j=b.tasks,f=b.count,p=Math.ceil(f/3),O=function(t){e(H(t))};return Object(c.useEffect)((function(){e(J())}),[o,i,a]),Object(r.jsxs)(y.a,{children:[Object(r.jsxs)(y.a,{className:t.utilsWrapper,children:[Object(r.jsxs)(y.a,{children:[Object(r.jsx)(st.a,{className:t.button,variant:"outlined",onClick:function(){return e(F())},endIcon:Object(r.jsx)("span",{className:"material-icons",children:"add_task"}),children:"New task"}),l.length>0&&Object(r.jsx)(st.a,{className:t.button,variant:"outlined",onClick:function(){e(q())},endIcon:Object(r.jsx)("span",{className:"material-icons",children:"save"}),children:"Save"})]}),p>0&&Object(r.jsx)(gt.a,{className:t.pagination,count:p,shape:"rounded",onChange:function(t,n){e(Rt(n))}})]}),j&&j.length?Object(r.jsx)(bt.a,{className:t.tableContainer,children:Object(r.jsxs)(jt.a,{children:[Object(r.jsx)(ft.a,{children:Object(r.jsx)(pt.a,{children:At.map((function(t){return Object(r.jsx)(Ot.a,{width:t.width,children:t.sortable?Object(r.jsx)(ht.a,{active:a===t.label,direction:i,onClick:function(){return n=t.label,void e(a!==n?Lt(n):Bt("desc"===i?"asc":"desc"));var n},children:t.label}):t.label},t.label)}))})}),Object(r.jsx)(mt.a,{className:t.tableBody,children:j.map((function(e){return Object(r.jsxs)(pt.a,{children:[Object(r.jsx)(Ot.a,{children:e.id}),Object(r.jsx)(Ot.a,{children:e.username}),Object(r.jsx)(Ot.a,{children:e.email}),Object(r.jsx)(Ot.a,{children:Object(r.jsx)(it.a,{className:t.textField,variant:"outlined",value:e.text,label:Wt(e.status).edited?"Edited by admin":"",multiline:!0,rowsMax:3,disabled:!s,onChange:function(t){return function(t,e){O(Object(u.a)(Object(u.a)({},e),{},{text:t.target.value,status:_t(e.status,{edited:!0})}))}(t,e)}})}),Object(r.jsx)(Ot.a,{children:Object(r.jsx)(vt.a,{checked:Wt(e.status).done,onClick:function(t){return function(t,e){O(Object(u.a)(Object(u.a)({},e),{},{status:_t(e.status,{done:t.target.checked})}))}(t,e)},disabled:!s})})]},e.id)}))})]})}):null,Object(r.jsx)(dt,{})]})},Ut=n(138),Jt=n(144),Zt=function(t){var e=t.anchorEl,n=t.open,a=t.onClose,c=Object(d.b)(),i=Object(d.c)((function(t){return t.user.error})),o={username:{validator:tt},password:{validator:et("Enter password"),props:{type:"password"}}},s=n?"simple-popover":void 0;return Object(r.jsx)(Jt.a,{id:s,open:n,anchorEl:e,onClose:function(){a(),c(St())},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"},children:Object(r.jsx)(lt,{submitButtonLabel:"Log in",fieldsOptionsMap:o,onSubmit:function(t){c(kt(t)).then((function(t){"ok"===t.payload.status&&a&&a()}))},errors:i})})},qt=Object(nt.a)({body:{display:"flex",paddingTop:100,width:"100%",justifyContent:"center",fontSize:"calc(10px + 2vmin)"}}),Gt=Object(nt.a)((function(t){return{header:{position:"fixed",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",padding:"20px",backgroundColor:t.palette.secondary.light},logo:{pointerEvents:"none"}}})),Kt=(Object(nt.a)({loginPopover:{display:"flex",flexDirection:"column",padding:"0 20px",minWidth:250}}),function(){var t=Object(d.c)(Et),e=Object(d.b)(),n=i.a.useState(null),a=Object(E.a)(n,2),c=a[0],o=a[1],s=i.a.useState(!1),u=Object(E.a)(s,2),l=u[0],b=u[1],j=Gt();return Object(r.jsxs)(y.a,{className:j.header,children:[Object(r.jsx)(Ut.a,{variant:"h4",className:j.logo,children:"Tasks list"}),Object(r.jsx)("div",{children:t?Object(r.jsx)(st.a,{onClick:function(){e(Nt())},disableRipple:!0,endIcon:Object(r.jsx)("span",{className:"material-icons",children:"logout"}),children:"Log Out"}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(st.a,{onClick:function(t){o(t.currentTarget),b((function(t){return!t}))},disableRipple:!0,endIcon:Object(r.jsx)("span",{className:"material-icons",children:"login"}),children:"Log in"}),Object(r.jsx)(Zt,{anchorEl:c,open:l,onClose:function(){b(!1)}})]})})]})}),$t=function(){var t=qt();return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(g,{}),Object(r.jsx)(Kt,{}),Object(r.jsx)("div",{className:t.body,children:Object(r.jsx)(Ft,{})})]})},Ht=Object(j.a)({reducer:{tasks:K,tasksListState:Tt,newTaskModal:_,user:wt,notifications:p}});s.a.render(Object(r.jsx)(d.a,{store:Ht,children:Object(r.jsx)(b.a,{maxSnack:3,children:Object(r.jsx)($t,{})})}),document.getElementById("root"))}},[[94,1,2]]]);
//# sourceMappingURL=main.61ae4604.chunk.js.map